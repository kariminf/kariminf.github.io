!function(){function JsonVCard(){}function init(){var e=new XMLHttpRequest;e.overrideMimeType("application/json"),e.open("GET","./vcard.json",!0),e.onreadystatechange=function(){4===e.readyState&&"200"==e.status&&processJSON(e.responseText)},e.send(null)}function processJSON(e){var t=JSON.parse(e);document.title=t.perso.name+" "+t.perso.family;var a=processTheme(t.theme),r=new XMLHttpRequest;r.responseType="text",r.open("GET",a,!0),r.onreadystatechange=function(){4===r.readyState&&"200"==r.status&&cookTemplate(t,r.responseText)},r.send(null)}function cookTemplate(e,t){sharedResult=processObject("",e,t),document.body.innerHTML=sharedResult,processFiles()}function processTheme(e){var t="./themes/default/",a="default.css";return void 0!==e.name&&(t="./themes/"+e.name+"/",void 0!==e.style&&(a=e.style+".css")),addStyleSheet(t+a),t+"template.htm"}function addStyleSheet(e){if(!document.getElementById("myCss")){var t=document.getElementsByTagName("head")[0],a=document.createElement("link");a.id="myCss",a.rel="stylesheet",a.type="text/css",a.href=e,a.media="all",t.appendChild(a)}}function processObject(e,t,a){var r=a,n=null!==e&&e.length>0?e+".":"";for(var s in t)r=processData(n+s,t[s],r);return r}function processData(key,value,template){var marker="@{"+key+"%s}";if(template.indexOf(marker)>=0){var result;return eval("result = process_"+key+"(value, template);"),result}if("[object Array]"===Object.prototype.toString.call(value))return processArray(key,value,template);if("object"==typeof value)return processObject(key,value,template);var marker="@{"+key+"%r}";template.indexOf(marker)>=0&&files.push({marker:marker,url:value});var exp=eval("/@{"+key+"}/g");return template.replace(exp,value)}function processArray(key,data,template){var begin="@{"+key+"%sb}",idx_begin=template.indexOf(begin)+begin.length,end="@{"+key+"%se}",idx_end=template.indexOf(end);if(idx_begin<0||idx_end<0)return template;for(var arrayHTML=template.substring(idx_begin,idx_end),replacement="",exp=eval("/@{"+key+"([^}]*)}/gi"),i=0;i<data.length;i++){var elementHTML=arrayHTML.replace(exp,"@{"+key+"&"+i+"$1}");elementHTML=processData(key+"&"+i,data[i],elementHTML),replacement+=elementHTML+"\n"}return arrayHTML=begin+arrayHTML+end,template.replace(arrayHTML,replacement)}function processFiles(){for(console.log("template before adding files\n"+sharedResult);null!=(file=files.pop());)console.log("file marker: ",file.marker,", url= ",file.url),readFile(file.marker,file.url)}function readFile(e,t){var a=new XMLHttpRequest;a.responseType="text",a.open("GET",t,!0),mutex++,a.onreadystatechange=function(){if(4===a.readyState){var t="";"200"==a.status&&(t=a.responseText),sharedResult=sharedResult.replace(e,t),0===--mutex&&(document.body.innerHTML=sharedResult)}},a.send(null)}function process_social(e,t){var a="";for(var r in e)a+='<a href="'+e[r]+'" id="'+r,a+='" target="_blank"></a>';return t.replace("@{social%s}",a)}var mutex=0,sharedResult="",files=[];document.addEventListener("DOMContentLoaded",function(){init()})}();